<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Seção de Notas</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <style>
        .red {
            color: red;
        }

        .yellow {
            color: yellow;
        }

        .green {
            color: green;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Seção de Notas</h1>

        <h2>Adicionar Notas</h2>
        <form>
            <div class="form-group">
                <label for="subject">Matéria:</label>
                <select id="subject" class="form-control" onchange="checkGradeLimit()">
                    <option value="math">Matemática</option>
                    <option value="portuguese">Língua Portuguesa</option>
                    <option value="history">História</option>
                    <option value="physics">Física</option>
                    <option value="biology">Biologia</option>
                    <option value="chemistry">Química</option>
                    <option value="geography">Geografia</option>
                    <option value="philosophy">Filosofia</option>
                    <option value="physical_education">Educação Física</option>
                    <option value="sociology">Sociologia</option>
                    <option value="literature">Literatura</option>
                    <option value="arts">Artes</option>
                </select>
            </div>

            <div class="form-group">
                <label for="grade">Nota:</label>
                <input type="number" id="grade" class="form-control" min="0" max="10">
            </div>

            <button type="button" onclick="addGrade()" class="btn btn-primary" id="addButton">Adicionar</button>
        </form>

        <h2>Média</h2>
        <div id="average" class="mt-3"></div>

        <h2>Gráficos de Notas</h2>
        <div id="gradeCharts" class="row mt-3"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Variáveis para armazenar as notas e os rótulos das matérias
        var grades = {};
        var subjects = [];

        // Função para adicionar a nota
        function addGrade() {

            
            var subject = document.getElementById('subject').value;
            var grade = parseInt(document.getElementById('grade').value);

            if (grade > 10) {
                alert('A nota não pode ser maior que 10.');
                return;
            }

            if (!grades[subject]) {
                grades[subject] = [];
                subjects.push(subject);
            }

            
            if (grades[subject].length >= 3) {
                alert('Você já adicionou 3 notas para esta matéria.');
                gradeInput.value = '';
                return;
            }

            grades[subject].push(grade);

            document.getElementById('grade').value = '';

            var addButton = document.getElementById('addButton');
            if (grades[subject].length >= 3) {
                addButton.disabled = true;
            }

            updateAverage();
            updateCharts();
        }

        // Função para calcular a média e exibi-la na página
        function updateAverage() {
            var totalSum = 0;
            var totalCount = 0;

            for (var subject in grades) {
                var sum = grades[subject].reduce(function (a, b) {
                    return a + b;
                }, 0);
                var average = sum / grades[subject].length;

                totalCount += grades[subject].length;
                totalSum += sum;

                var averageElement = document.getElementById(subject + '_average');
                if (!averageElement) {
                    averageElement = document.createElement('div');
                    averageElement.id = subject + '_average';
                    document.getElementById('average').appendChild(averageElement);
                }

                averageElement.innerHTML = '<strong>' + subject + ':</strong> ';

                if (average < 6) {
                    averageElement.innerHTML += '<span class="red">' + average.toFixed(2) + '</span>';
                } else if (average >= 6 && average < 8) {
                    averageElement.innerHTML += '<span class="yellow">' + average.toFixed(2) + '</span>';
                } else {
                    averageElement.innerHTML += '<span class="green">' + average.toFixed(2) + '</span>';
                }
            }

            var totalAverage = totalSum / totalCount;

            var totalAverageElement = document.getElementById('total_average');
            if (!totalAverageElement) {
                totalAverageElement = document.createElement('div');
                totalAverageElement.id = 'total_average';
                document.getElementById('average').appendChild(totalAverageElement);
            }

            totalAverageElement.innerHTML = '<strong>Média Geral:</strong> ';

            if (totalAverage < 6) {
                totalAverageElement.innerHTML += '<span class="red">' + totalAverage.toFixed(2) + '</span>';
            } else if (totalAverage >= 6 && totalAverage < 8) {
                totalAverageElement.innerHTML += '<span class="yellow">' + totalAverage.toFixed(2) + '</span>';
            } else {
                totalAverageElement.innerHTML += '<span class="green">' + totalAverage.toFixed(2) + '</span>';
            }
        }

        // Função para atualizar os gráficos de notas
        function updateCharts() {
            var gradeCharts = document.getElementById('gradeCharts');
            gradeCharts.innerHTML = '';

            for (var i = 0; i < subjects.length; i++) {
                var subject = subjects[i];

                var canvas = document.createElement('canvas');
                canvas.id = subject + '_chart';
                canvas.classList.add('col-md-6', 'mt-3');
                gradeCharts.appendChild(canvas);

                var ctx = canvas.getContext('2d');

                var data = {
                    labels: ['1ª Avaliação', '2ª Avaliação', '3ª Avaliação'],
                    datasets: [{
                        label: subject,
                        data: grades[subject],
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                };

                var options = {
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10
                        }
                    }
                };

                new Chart(ctx, {
                    type: 'bar',
                    data: data,
                    options: options
                });
            }
        }

        // Função para verificar o limite de nota
        function checkGradeLimit() {
            var subject = document.getElementById('subject').value;
            var addButton = document.getElementById('addButton');

            if (grades[subject] && grades[subject].length >= 3) {
                addButton.disabled = true;
                document.getElementById('grade').disabled = true;
            } else {
                addButton.disabled = false;
                document.getElementById('grade').disabled = false;
            }
        }
    </script>
</body>

</html>